<?phpsession_start();include_once '../dbconnect.php';	if (isset($_SESSION['odontoUserSession_ID']))	{	  $query = $DBcon->query("SELECT user_type FROM access WHERE id=".$_SESSION['odontoUserSession_ID']);	  $userRow=$query->fetch_array();	  		if ($userRow['user_type'] != 'root' and $userRow['user_type'] != 'admin')		  header("Location: ../index.php");		  	  $DBcon->close();		}else	  header("Location: ../index.php");?><!doctype html><html>  <head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />	<link rel="shortcut icon" href="../img/icon.png" type="image/x-icon">	<link rel="stylesheet" type="text/css" href="../css/main.css?version=1">	<title>Odontologia Especializada</title>   </head>  <script language="javascript">	function AreYouSure(form)	{	  return confirm('Tem certeza de que deseja deletar?');	}  </script>  <body>  <!-- Divisão, corpo da página inteira. -->  <div id="wrapper">  	<div id="header" class="no-print"> <!-- Cabeçalho. -->   	  <?php $nb = file_get_contents('./default/navbar.html'); echo $nb; ?>	</div> <!-- Fim Cabeçalho. -->	     <!-- Corpo da página. -->	<div id="content">  		  <form action="" method="post">	  		<input type="date" name="search_date" value="<?php $Search = date("Y-m-d"); echo $Search; ?>">		<button type="submit" name="search" style="position: absolute;"><img class="icon" src="../img/go.png"></button>	  </form>	  		<?php		  			  if (isset($_POST['search'])) {								// MySQL Connection  				   $DBcon = new MySQLi($DBhost,$DBuser,$DBpass,$DBname);										 if ($DBcon->connect_errno) {						 die("ERROR : -> ".$DBcon->connect_error);					 }								$Date =	htmlspecialchars($_POST["search_date"]);				$Time = sprintf("%02d", 7) . ":" . sprintf("%02d", 30) . ":00";								$Start = $Date . " " . $Time;				  $Search = $Start;				$End = date("Y-m-d H:i:s", strtotime($Start . "+11 hours"));								echo '<br><span class="server_response">Exibindo agenda do dia ' . date("d/m/Y", strtotime($Date)) . '... </span>';								// Show all appointments				while ($Search < $End)				{				  				  $Search = date("Y-m-d H:i:s", strtotime($Search . "+30 minutes"));				  					$line = $DBcon->query("SELECT patient,type,doc,date FROM `agenda` WHERE `date_time` = '$Search'");					  $row = $line->fetch_assoc();					  						$Name = $row['patient'];						$Type = $row['type'];						$Doc = $row['doc'];						$Date = $row['date'];											$line->free();										if ($Name == "INVALID") {		?>											<form id='appointment' action='' method='post'>										  <div id='subtitle' style='height: 55px; padding-right: 10px; background: rgba(187, 105, 87, 0.7);'>						<?php echo date("H:i:s", strtotime($Search)); ?>						<button id='imgbut' type='submit' name='delete' onclick='return AreYouSure(this);'> <img class='icon' src='../img/trash.png'></button>						<button id='imgbut' type='submit' name='update'> <img class='icon' src='../img/save.png'></button>					  </div>														  <input type='text' name='date_time' value='<?php echo $Search; ?>' style='display: none;'>								  					  <div id='container' style='background: rgba(255, 46, 0, 0.3);'>															<p>						  <label for='name'>Nome</label><br>						  <input type='text' name='name' value='' style='width:100%; height:20px;' disabled>						</p>																<p>						  <label for='type'>Procedimento</label><br>						  <select name='type' style='width:100%; height:25px;' disabled>							<option selected></option>														<?php			  							    $query = $DBcon->query("SELECT * FROM `types`");												  									while($array = $query->fetch_array())									{										echo "<option value='$array[1]'>$array[1]</option>";									}										$query->free();							?>						  </select>						</p>						  <label for='doc'>Atendente</label><br>						  <select name='doc' style='width:100%; height:25px;' disabled>							<option selected></option>							<?php			  							    $query = $DBcon->query("SELECT * FROM `doctors`");												  									while($array = $query->fetch_array())									{										echo "<option value='$array[1]'>$array[1]</option>";									}										$query->free();							?>						  </select>					  </div>					</form>		<?php									}else{		?>		 					<form id='appointment' action='' method='post'>										  <div id='subtitle' style='height: 55px; padding-right: 10px;'>						<?php echo date("H:i:s", strtotime($Search)); ?>						<button id='imgbut' type='submit' name='delete' onclick='return AreYouSure(this);'> <img class='icon' src='../img/trash.png'></button>						<button id='imgbut' type='submit' name='update'> <img class='icon' src='../img/save.png'></button>					  </div>														  <input type='text' name='date_time' value='<?php echo $Search; ?>' style='display: none;'>								  					  <div id='container'>															<p>						  <label for='name'>Nome</label><br>						  <input type='text' name='name' value='<?php echo $Name; ?>' style='width:100%; height:20px;'>						</p>																<p>						  <label for='type'>Procedimento</label><br>						  <select name='type' style='width:100%; height:25px;'>							<option selected></option>														<?php			  							    $query = $DBcon->query("SELECT * FROM `types`");												  									while($array = $query->fetch_array())									{																	  if($array[1] == $Type)										echo "<option value='$array[1]' selected>$array[1]</option>";									  else										echo "<option value='$array[1]'>$array[1]</option>";									}										$query->free();							?>						  </select>						</p>						  <label for='doc'>Atendente</label><br>						  <select name='doc' style='width:100%; height:25px;'>							<option selected></option>							<?php			  							    $query = $DBcon->query("SELECT * FROM `doctors`");												  									while($array = $query->fetch_array())									{										  if($array[1] == $Doc)										echo "<option value='$array[1]' selected>$array[1]</option>";									  else										echo "<option value='$array[1]'>$array[1]</option>";									}										$query->free();							?>						  </select>					  </div>					</form>		<?php					}								}								  // Closing the DB connection				  $DBcon->close();			  }			  			  if (isset($_POST['delete'])) {			  // User Data			  $Date_Time	=	htmlspecialchars($_POST["date_time"]);			  				// MySQL Connection  				   $DBcon = new MySQLi($DBhost,$DBuser,$DBpass,$DBname);										 if ($DBcon->connect_errno) {						 die("ERROR : -> ".$DBcon->connect_error);					 }								  $delete = $DBcon->query("DELETE FROM `agenda` WHERE `agenda`.`date_time` = '$Date_Time'");									if ($delete != false)					  echo '<span class="server_response">Horário liberado!</span>';					else					  echo '<span class="server_response">Error... </span>';			  // Closing the DB connection			  $DBcon->close();}			  			  if (isset($_POST['update'])) {			  // User Data			  $Date_Time	=	htmlspecialchars($_POST["date_time"]);			  $Name			=	htmlspecialchars($_POST["name"]); if ($Name == "") { $Name = "INVALID";}			  $Type			=	htmlspecialchars($_POST["type"]);			  $Doc			=	htmlspecialchars($_POST["doc"]);			  			  			  $Date			=	date("Y-m-d", strtotime( $Date_Time ));			  				// MySQL Connection  				   $DBcon = new MySQLi($DBhost,$DBuser,$DBpass,$DBname);										 if ($DBcon->connect_errno) {						 die("ERROR : -> ".$DBcon->connect_error);					 }					 					$line = $DBcon->query("SELECT id FROM `agenda` WHERE `date_time` = '$Date_Time'");					$array = $line->fetch_array();									  if ($line)					if ($array)					{					  $ResultID = $array[0];					  					  $DBcon->query( 					  "UPDATE `agenda` SET `date_time` = '$Date_Time', `patient` = '$Name', `type` = '$Type', `doc` = '$Doc', `date` = '$Date'					   WHERE `agenda`.`id` = $ResultID");					   					   echo '<span class="server_response">Horário alterado!</span>';					}else{					  $DBcon->query(					  "INSERT INTO `agenda` (`id`, `date_time`, `patient`, `type`, `doc`, `date`) VALUES					  (NULL, '$Date_Time', '$Name', '$Type', '$Doc', '$Date');");					  					  echo '<span class="server_response">Horário agendado!</span>';					}					  $line->free();			  // Closing the DB connection			  $DBcon->close();}			  		?>	</div>  <!-- Fim Corpo da página. -->    	<div id="footer"><!-- Rodapé. -->	  Developed by Isaque Costa.<br>isaquecostaa@gmail.com	</div><!-- Fim Rodapé. -->	  </div> <!-- Fim Divisão corpo da página. -->	</body></html>